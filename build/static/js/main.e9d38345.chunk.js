(this["webpackJsonptest-timers"]=this["webpackJsonptest-timers"]||[]).push([[0],{39:function(e,t,n){},40:function(e,t,n){},66:function(e,t,n){"use strict";n.r(t);var c=n(1),s=n.n(c),i=n(34),a=n.n(i),r=n(12),o=(n(39),n(40),n(41),n(2)),l=n(3),u=n(22),d=n.p+"static/media/beep.94ec08ca.mp3",j=function(e,t){return JSON.parse(window.localStorage.getItem(e))||t[e]},b=function(e,t){window.localStorage.setItem(e,JSON.stringify(t))},f=function(e,t,n){var c=j(e,Object(u.a)({},e,[]));b(e,c.filter((function(e){return e[n]!==t[n]})))},m=new Audio(d),O={pxWidth:1366,cmWidth:41,boxes:10,size:[7,2],time:{ready:15,alarm:19,limit:20}},h={pxWidth:j("pxWidth",O),setPxWidth:Object(l.b)((function(e,t){e.pxWidth=t})),cmWidth:j("cmWidth",O),setCmWidth:Object(l.b)((function(e,t){e.cmWidth=t})),boxes:j("boxes",O),setBoxes:Object(l.b)((function(e,t){e.boxes=t})),size:j("size",O),setSize:Object(l.b)((function(e,t){e.size=t})),time:j("time",O),setTime:Object(l.b)((function(e,t){e.time=t})),clock:Date(),setClock:Object(l.b)((function(e,t){e.clock=t})),network:!1,setNetwork:Object(l.b)((function(e,t){e.network=t})),message:"Scan a test",setMessage:Object(l.b)((function(e,t){e.message=t}))},x=n(4),p=n(19),v=n(6),g=n.n(v),N=n(11),w=n(10),D=n.n(w),S="http://".concat(window.location.hostname,":9999"),k="http://".concat(window.location.hostname,":5102"),y=function(){var e=Object(N.a)(g.a.mark((function e(t){var n,c;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("... sending results:",t),n="".concat(k,"/api/covidratesting/device/ratestresult"),e.next=4,E(n,t);case 4:return c=e.sent,e.abrupt("return",c.data);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),I=function(){var e=Object(N.a)(g.a.mark((function e(){var t,n;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("... getting events"),t="".concat(S,"/network/scan"),e.next=4,D.a.get(t);case 4:return n=e.sent,e.abrupt("return",n.data);case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),T=function(){var e=Object(N.a)(g.a.mark((function e(t,n){var c,s;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("... configure wifi"),c="".concat(S,"/network/save"),e.next=4,D.a.post(c,{ssid:t,pass:n});case 4:return s=e.sent,e.abrupt("return",s.data);case 6:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),C=function(){var e=Object(N.a)(g.a.mark((function e(){var t,n;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("... get device ID"),t="".concat(S,"/device/id"),e.next=4,D.a.get(t);case 4:return n=e.sent,console.log(n.data),e.abrupt("return",n.data);case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),W=function(){var e=Object(N.a)(g.a.mark((function e(){var t,n;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("... get git commit"),t="".concat(S,"/git/commit"),e.next=4,D.a.get(t);case 4:return n=e.sent,e.abrupt("return",n.data);case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),E=function(e,t){return D.a.defaults.headers.post["Access-Control-Allow-Origin"]="*",D.a.patch(e,t)},R=n(13),z=n(14),L=n(0),P=function(e){var t=e.to;return Object(L.jsx)(r.b,{to:t,className:"navigator",children:"/home"===t?Object(L.jsx)(R.a,{icon:z.a}):Object(L.jsx)(R.a,{icon:z.c})})},A=function(e){var t=e.handleNegative,n=e.handlePositive,s=e.handleInvalid,i=e.handleMismatch,a=Object(l.d)((function(e){return e.setMessage})),r=Object(c.useState)(null),o=Object(x.a)(r,2),u=o[0],d=o[1],j=Object(c.useState)(3),b=Object(x.a)(j,2),f=b[0],m=b[1],O=Object(c.useState)(),h=Object(x.a)(O,2),p=h[0],v=h[1],g=Object(c.useState)(),N=Object(x.a)(g,2),w=N[0],D=N[1],S=Object(c.useState)(),k=Object(x.a)(S,2),y=k[0],I=k[1],T=null,C=function(e){return/^[#|$|%]$/.test(e)};return Object(c.useEffect)((function(){var e=function(e){var t=e.key;C(t)&&(I(t),D(Date.now()),null===T&&(T=t,d(t),a("Press again to confirm:"))),"F5"===t&&e.preventDefault()};document.addEventListener("keydown",e);var t=setInterval((function(){v(Date.now())}),1e3);return function(){document.removeEventListener("keydown",e),clearInterval(t)}}),[]),Object(c.useEffect)((function(){null!==u?(m(f-1),f-1):(m(3),3)}),[p]),Object(c.useEffect)((function(){f<=0&&C(y)&&("#"===y&&"#"===u&&t(),"$"===y&&"$"===u&&n(),"%"===y&&"%"===u&&s(),y!==u&&i())}),[w]),Object(L.jsxs)("div",{className:"field is-grouped mt-4",children:[("#"===u||null===u)&&Object(L.jsx)("button",{className:"button is-large is-outlined is-success",disabled:null!==u&&f>0,children:"Not detected"}),("$"===u||null===u)&&Object(L.jsx)("button",{className:"button is-large ml-4 is-outlined is-danger",disabled:null!==u&&f>0,children:"Detected"}),("%"===u||null===u)&&Object(L.jsx)("button",{className:"button is-large ml-4 is-outlined is-warning",disabled:null!==u&&f>0,children:"Incomplete"})]})},F=function(e){var t=e.test,n=e.setReady,s=e.setFree,i=t.id,a=t.specimenID,r=Object(c.useState)(0),o=Object(x.a)(r,2),u=o[0],d=o[1],j=Object(c.useState)("free"),b=Object(x.a)(j,2),f=b[0],O=b[1],h=Object(l.e)((function(e){return e.size})),p=Object(l.e)((function(e){return e.pxWidth})),v=Object(l.e)((function(e){return e.cmWidth})),g=Object(l.e)((function(e){return e.clock})),N=Object(l.e)((function(e){return e.time})),w=N.ready,D=N.limit,S=N.alarm,k=p/v,y=[parseInt(h[0]*k),parseInt(h[1]*k)],I={height:y[1],width:y[0],minHeight:y[1],minWidth:y[0]},T=function(){O("counting")},C=function(){O("free"),d(0),n(i,!1),s(i)};return Object(c.useEffect)((function(){"free"!==f&&d(u+1),u>=w&&(O("finished"),n(i,!0)),u>=D&&O("overtime"),u>=S&&m.play()}),[g]),Object(c.useEffect)((function(){null!==a?T():C()}),[a]),Object(L.jsx)(L.Fragment,{children:Object(L.jsxs)("div",{className:"out-box animate__animated has-background-".concat(("free"===f?"success":"counting"===f&&"warning")||"finished"===f&&"danger"||"overtime"===f&&"danger"," ").concat("overtime"===f&&"animate__flash animate__infinite"),children:[Object(L.jsxs)("div",{className:"is-flex is-flex-centered has-background-black is-flex-column",style:I,children:[Object(L.jsx)("p",{className:"help is-success box-code is-size-4",children:a}),Object(L.jsxs)("div",{className:"field is-grouped",children:[Object(L.jsx)("button",{className:"button m-1 is-small is-rounded",onClick:T,children:">"}),Object(L.jsx)("button",{className:"button m-1 is-small is-rounded",onClick:C,children:"[X]"}),Object(L.jsx)("button",{className:"button m-1 is-small is-rounded",children:u})]})]}),Object(L.jsx)("progress",{className:"progress is-info mt-2",max:w,value:u})]})})},M=function(){var e=Object(l.e)((function(e){return e.network}));return Object(L.jsx)(r.b,{to:"/wifi",className:"wifi",children:Object(L.jsx)(R.a,{icon:z.d,className:e?"has-text-success":"has-text-grey"})})},_=function(){var e=Object(l.e)((function(e){return e.boxes})),t=Object(l.e)((function(e){return e.message})),n=Object(l.e)((function(e){return e.clock})),s=Object(l.e)((function(e){return e.network})),i=Object(l.d)((function(e){return e.setClock})),a=Object(l.d)((function(e){return e.setMessage})),r=Object(l.d)((function(e){return e.setNetwork})),o=Object(p.a)(Array(parseInt(e)).keys()),u=[];o.forEach((function(e){u.push({id:e,specimenID:null,ready:!1,processingDateTime:null})}));var d=Object(c.useState)(""),b=Object(x.a)(d,2),m=b[0],O=b[1],h=Object(c.useState)(""),v=Object(x.a)(h,2),g=v[0],N=v[1],w=Object(c.useState)(""),D=Object(x.a)(w,2),S=D[0],k=D[1],I=Object(c.useState)(!1),T=Object(x.a)(I,2),W=T[0],E=T[1],R=Object(c.useState)(Date.now()),z=Object(x.a)(R,2),_=z[0],$=z[1],J=Object(c.useState)(u),B=Object(x.a)(J,2),H=B[0],V=B[1],X=Object(c.useState)(""),q=Object(x.a)(X,2),G=q[0],K=q[1],Q=function(e,t){Object(p.a)(H)[e].ready=t},U=function(e){var t=Object(p.a)(H);t[e].specimenID=null,V(t)},Y=function(){E(!1),a(""),console.log(S);var e=H.find((function(e){return e.specimenID===S}));U(e.id),Q(e.id,!1);var t=(new Date).toLocaleString()+"";return{processingDateTime:e.processingDateTime,resultDateTime:t}},Z=function(e){console.log("... data send:",e),f("recorded",e,"specimenID")},ee=function(e){console.error("... data not send",e),console.error("... save to local storage",e)};return Object(c.useEffect)((function(){var e=Date.now();N("".concat(e-_>500?"":g).concat(m)),$(e)}),[m]),Object(c.useEffect)((function(){if(Date.now()-_>500&&""!==g){k(g);var e=Object(p.a)(H),t=e.map((function(e){return e.specimenID})),n=t.indexOf(null);if(!t.includes(g))E(!1),n>=0?(H[n].specimenID=g,H[n].processingDateTime=(new Date).toLocaleString()+"",function(e,t){var n={SpecimenID:e,CovidTestResultID:null,CovidTestStatusID:3,DeviceID:G,ProcessingDateTime:t,ResultDateTimeTicks:null};y(n).then((function(){return Z(n)})).catch((function(){return ee(n)}))}(g,H[n].processingDateTime),a("Starting timer for test: "+g)):a("No box available for: "+g);else H.find((function(e){return e.specimenID===g})).ready?(a("Test ".concat(g," is ready, select an option: ")),E(!0)):a("Test ".concat(g," is not ready"));V(e),N("")}}),[n]),Object(c.useEffect)((function(){if(s){var e=j("recorded",{recorded:[]});console.log("Send data from storage"),e.forEach((function(e){console.log("...sending data:",e),y(e).then((function(){return f("recorded",e,"specimenID")}))}))}}),[s]),Object(c.useEffect)((function(){C().then((function(e){return K(e.id)}));var e=function(e){var t=e.key;1===t.length&&/\w/.test(t)&&O(t),"F5"===t&&e.preventDefault()},t=setInterval((function(){i(Date())}),500);return document.addEventListener("keydown",e),window.addEventListener("offline",(function(){return r(!1)})),window.addEventListener("online",(function(){return r(!0)})),r(window.navigator.onLine),function(){document.removeEventListener("keydown",e),window.removeEventListener("offline",(function(){return r(!1)})),window.removeEventListener("online",(function(){return r(!0)})),clearInterval(t)}}),[]),Object(L.jsxs)("div",{className:"home-container",children:[Object(L.jsxs)("header",{children:[Object(L.jsx)("p",{className:"has-text-centered title mt-4",children:t}),W&&Object(L.jsx)(A,{handleNegative:function(){var e=Y(),t=e.processingDateTime,n=e.resultDateTime,c={SpecimenID:S,CovidTestResultID:1,CovidTestStatusID:4,DeviceID:G,ProcessingDateTime:t,ResultDateTime:n};y(c).then((function(){return Z(c)})).catch((function(){return ee(c)}))},handlePositive:function(){var e=Y(),t=e.processingDateTime,n=e.resultDateTime,c={SpecimenID:S,CovidTestResultID:2,CovidTestStatusID:4,DeviceID:G,ProcessingDateTime:t,ResultDateTime:n};y(c).then((function(){return Z(c)})).catch((function(){return ee(c)}))},handleInvalid:function(){var e=Y(),t=e.processingDateTime,n=e.resultDateTime,c={SpecimenID:S,CovidTestResultID:3,CovidTestStatusID:6,DeviceID:G,ProcessingDateTime:t,ResultDateTime:n};y(c).then((function(){return Z(c)})).catch((function(){return ee(c)}))},handleMismatch:function(){E(!1),a("")}})]}),Object(L.jsxs)("div",{className:"box-container",children:[H.map((function(e){return Object(L.jsx)(F,{test:e,setReady:Q,setFree:U},e.id)})),Object(L.jsx)(P,{to:"/config",onClick:function(){return console.log("Clicked Navigator")}}),Object(L.jsx)(M,{})]})]})},$=n(15),J=function(e){var t=e.active,n=e.setActive,c=e.title,s=e.confirm,i=e.setAction;return Object(L.jsxs)("div",{className:"modal ".concat(t&&"is-active"),children:[Object(L.jsx)("div",{className:"modal-background"}),Object(L.jsxs)("div",{className:"modal-card",children:[Object(L.jsx)("header",{className:"modal-card-head",children:Object(L.jsx)("p",{className:"modal-card-title",children:c})}),Object(L.jsxs)("footer",{className:"modal-card-foot is-flex-end",children:[Object(L.jsx)("button",{className:"button is-success is-outlined",onClick:function(){return i()},children:s}),Object(L.jsx)("button",{className:"button",onClick:function(){return n(!1)},children:"Cancel"})]})]})]})},B=function(){var e=Object(o.f)(),t=Object(c.useState)(""),n=Object(x.a)(t,2),s=n[0],i=n[1],a=Object(c.useState)(!1),r=Object(x.a)(a,2),u=r[0],d=r[1],j=Object(c.useState)(!1),f=Object(x.a)(j,2),m=f[0],O=f[1],h=Object(c.useState)(""),p=Object(x.a)(h,2),v=p[0],g=p[1],N=Object(c.useState)(""),w=Object(x.a)(N,2),D=w[0],S=w[1],k=Object(l.e)((function(e){return e.pxWidth})),y=Object(l.e)((function(e){return e.cmWidth})),I=Object(l.e)((function(e){return e.boxes})),T=Object(l.e)((function(e){return e.size})),E=Object(l.e)((function(e){return e.time})),A=Object(l.d)((function(e){return e.setPxWidth})),F=Object(l.d)((function(e){return e.setCmWidth})),M=Object(l.d)((function(e){return e.setBoxes})),_=Object(l.d)((function(e){return e.setSize})),B=Object(l.d)((function(e){return e.setTime})),H=Object(c.useState)(k),V=Object(x.a)(H,2),X=V[0],q=V[1],G=Object(c.useState)(y),K=Object(x.a)(G,2),Q=K[0],U=K[1],Y=Object(c.useState)(I),Z=Object(x.a)(Y,2),ee=Z[0],te=Z[1],ne=Object(c.useState)(T),ce=Object(x.a)(ne,2),se=ce[0],ie=ce[1],ae=Object(c.useState)(E),re=Object(x.a)(ae,2),oe=re[0],le=re[1];return Object(c.useEffect)((function(){C().then((function(e){return g(e.id)})),W().then((function(e){return S(e.commit.date)}))})),Object(L.jsxs)(L.Fragment,{children:[Object(L.jsx)(P,{to:"/home"}),Object(L.jsx)("div",{className:"is-flex is-flex-centered config",children:Object(L.jsxs)("div",{children:[Object(L.jsx)("h1",{className:"subtitle has-text-centered",children:"Configuration"}),Object(L.jsxs)("div",{className:"field",children:[Object(L.jsx)("label",{className:"label",children:"Number of boxes"}),Object(L.jsx)("div",{className:"control",children:Object(L.jsx)("input",{className:"input",type:"number",placeholder:"10",value:ee,onChange:function(e){return te(e.target.value)}})})]}),Object(L.jsxs)("div",{className:"field",children:[Object(L.jsx)("label",{className:"label",children:"Width of screen in pixels."}),Object(L.jsx)("div",{className:"control",children:Object(L.jsx)("input",{className:"input",type:"number",placeholder:"1366",value:X,onChange:function(e){return q(e.target.value)}})})]}),Object(L.jsxs)("div",{className:"field",children:[Object(L.jsx)("label",{className:"label",children:"Width of screen in centimeters."}),Object(L.jsx)("div",{className:"control",children:Object(L.jsx)("input",{className:"input",type:"number",placeholder:"41",value:Q,onChange:function(e){return U(e.target.value)}})})]}),Object(L.jsxs)("div",{className:"field",children:[Object(L.jsx)("label",{className:"label",children:"Size of box in cm."}),Object(L.jsxs)("div",{className:"control is-flex",children:[Object(L.jsx)("input",{className:"input",type:"number",placeholder:"7",value:se[0],onChange:function(e){return ie([e.target.value,se[1]])},title:"Width"}),Object(L.jsx)("input",{className:"input ml-4",type:"number",placeholder:"2",value:se[1],onChange:function(e){return ie([se[0],e.target.value])},title:"Height"})]})]}),Object(L.jsxs)("div",{className:"field",children:[Object(L.jsx)("label",{className:"label",children:"Process time in min."}),Object(L.jsxs)("div",{className:"control is-flex",children:[Object(L.jsx)("input",{className:"input",type:"number",placeholder:"15",value:oe.ready,title:"Ready to read time",onChange:function(e){return le(Object($.a)(Object($.a)({},oe),{},{ready:e.target.value}))}}),Object(L.jsx)("input",{className:"input ml-4",type:"number",placeholder:"19",value:oe.alarm,title:"Alarm time",onChange:function(e){return le(Object($.a)(Object($.a)({},oe),{},{alarm:e.target.value}))}}),Object(L.jsx)("input",{className:"input ml-4",type:"number",placeholder:"20",value:oe.limit,title:"Maximum time to get reading",onChange:function(e){return le(Object($.a)(Object($.a)({},oe),{},{limit:e.target.value}))}})]})]}),Object(L.jsx)("button",{onClick:function(){A(X),F(Q),M(ee),_(se),B(oe),b("pxWidth",X),b("cmWidth",Q),b("boxes",ee),b("size",se),b("time",oe),i(" ... going home"),d(!0),setTimeout((function(){return e("/home")}),1e3)},className:"button is-success is-outlined mt-4 ".concat(u&&"is-loading"),children:"Save"}),Object(L.jsx)("p",{className:"help",children:s}),Object(L.jsxs)("div",{className:"is-flex is-flex-centered m-4 ",children:[Object(L.jsx)(R.a,{icon:z.b,className:"has-text-danger pointer",size:"lg",onClick:function(){return O(!0)}}),Object(L.jsx)(J,{active:m,setActive:O,setAction:function(){console.log("... powering off")},title:"Do you want to shutdown?",confirm:"Shutdown"})]}),Object(L.jsxs)("div",{className:"is-flex mt-4 is-flex-between",children:[Object(L.jsxs)("p",{className:"has-text-grey mt-4",children:["ID: ",v]}),Object(L.jsxs)("p",{className:"has-text-grey mt-4",children:["Version: ",D]})]})]})})]})},H=function(){var e=Object(o.f)(),t=Object(c.useState)(!1),n=Object(x.a)(t,2),s=n[0],i=n[1],a=Object(c.useState)([]),r=Object(x.a)(a,2),l=r[0],u=r[1],d=Object(c.useRef)(),j=Object(c.useRef)();return Object(c.useEffect)((function(){I().then((function(e){return u(e.networks)}))}),[]),Object(L.jsxs)(L.Fragment,{children:[Object(L.jsx)(P,{to:"/home"}),Object(L.jsx)("div",{className:"is-flex is-flex-centered config",children:Object(L.jsxs)("div",{children:[Object(L.jsx)("h1",{className:"subtitle has-text-centered",children:"Wifi Configuration"}),Object(L.jsxs)("div",{className:"field",children:[Object(L.jsx)("label",{className:"label",children:"SSID"}),Object(L.jsx)("div",{className:"control",children:Object(L.jsx)("input",{className:"input",type:"text",placeholder:"WiFi SSID",ref:d})})]}),Object(L.jsxs)("div",{className:"field",children:[Object(L.jsx)("label",{className:"label",children:"Password"}),Object(L.jsx)("div",{className:"control",children:Object(L.jsx)("input",{className:"input",type:"text",placeholder:"********",ref:j})})]}),Object(L.jsx)("button",{onClick:function(){i(!0),T(d.current.value,j.current.value),setTimeout((function(){return e("/home")}),1e3)},className:"button is-success is-outlined mt-4 ".concat(s&&"is-loading"),children:"Save"}),Object(L.jsx)("p",{className:"help",children:""}),Object(L.jsx)("p",{className:"mt-4 has-text-centered",children:"Available networks"}),Object(L.jsxs)("table",{className:"table is-striped is-fullwidth",children:[Object(L.jsx)("thead",{children:Object(L.jsxs)("tr",{children:[Object(L.jsx)("th",{children:" SSID "}),Object(L.jsx)("th",{children:" SNR "})]})}),Object(L.jsx)("tbody",{children:l.map((function(e){return Object(L.jsxs)("tr",{children:[Object(L.jsx)("td",{children:e.ssid}),Object(L.jsx)("td",{children:e.snr})]})}))})]})]})})]})},V=Object(l.c)(h),X=function(){return Object(L.jsx)("div",{children:Object(L.jsx)(l.a,{store:V,children:Object(L.jsxs)(o.c,{children:[Object(L.jsx)(o.a,{path:"home",element:Object(L.jsx)(_,{})}),Object(L.jsx)(o.a,{path:"config",element:Object(L.jsx)(B,{})}),Object(L.jsx)(o.a,{path:"wifi",element:Object(L.jsx)(H,{})}),Object(L.jsx)(o.a,{path:"*",element:Object(L.jsx)(_,{})})]})})})};a.a.render(Object(L.jsx)(s.a.StrictMode,{children:Object(L.jsx)(r.a,{children:Object(L.jsx)(X,{})})}),document.getElementById("root"))}},[[66,1,2]]]);
//# sourceMappingURL=main.e9d38345.chunk.js.map